# Scene 3D JetLoader

Мини‑приложение Vue 3 + Three.js, демонстрирующее 3D‑сцену погрузки из JetLoader.

Цель — декомпозиция чанка сцены (chunk-e8267cc8) и вынос чистой 3D‑визуализации и базового алгоритма укладки в отдельный репозиторий.

## Стек и библиотеки

- Vue 3 (Composition API) — UI
- Vite — сборка и dev‑сервер
- Three.js r153 — 3D графика (основная библиотека)
  - OrbitControls — управление камерой мышью (вращение/приближение/панорамирование)

## Архитектура

```
src/
  App.vue                  # Каркас приложения (панели, метрики, управление)
  components/
    ThreeScene.vue         # 3D сцена: транспорт, груз, освещение, сетка
  types.ts                 # Доменные типы (груз, площадка, настройки, сводка)
  main.ts                  # Точка входа
```

### ThreeScene.vue
- Создаёт сцену (THREE.Scene), камеру (PerspectiveCamera), рендерер (WebGLRenderer) и OrbitControls
- Добавляет сетку пола и оси координат
- Добавляет группы объектов: грузовые площадки (loadsGroup) и грузовые места (cargoGroup)
- Рендерит в loop с requestAnimationFrame

### Система координат и единицы
- Оси: X — длина, Z — ширина, Y — высота
- Единицы — метры
- Площадка рисуется как BoxGeometry(l, h, w) и центрируется по полу
- Грузы — BoxGeometry(ln, hg, wd) размещаются на площадке

## Алгоритм укладки (упрощённый)

В этом мини‑приложении реализован базовый построчный укладчик, совместимый с ожиданиями UI и демонстрациями JetLoader:

1. Берём первую грузовую площадку (loads[0])
2. Идём по списку грузов, для каждого — повторяем cn раз
3. Размещаем слева направо по ширине (ось Z), накапливая глубину ряда (ось X)
4. При переполнении ширины — перенос на следующий ряд: z=0, x += rowMaxDepth
5. Если по длине не помещается или превышает высоту — помечаем как исключённый (красный)

Это «reference implementation» для визуализации и быстрой проверки. В полноценном JetLoader используются более продвинутые алгоритмы 3D bin packing с учётом поворотов, ярусности, устойчивости и физики.

## Использование

### Установка и запуск

```bash
npm i
npm run dev
# откройте http://localhost:5173
```

### Сборка

```bash
npm run build
npm run preview
```

## API компонентов

### <ThreeScene>

Props:
- cargoItems: CargoItem[] — список грузовых мест
- loads: LoadArea[] — список грузовых площадок
- settings: SceneSettings — настройки сцены (snap/hang зарезервированы для расширений)

События:
- updated(SceneSummary) — сводные показатели (count/weight/volume/freeVolume)

Expose (через ref):
- reset(): void — сброс камеры/контролов
- toBlob(): Promise<Blob|null> — скриншот сцены

Типы см. в src/types.ts

## Тестирование

Покрыты сценарии:
- Рендер площадки и грузов, корректная геометрия и позиционирование
- Пересчёт метрик при изменении props
- Скриншот через toBlob()
- Адаптация размера при ресайзе окна

Проверено вручную в последних Chrome/Firefox/Edge. DevTools: отсутствуют ошибки и предупреждения.

## Расширение (рекомендации)

- Поддержка вращения грузов (rt) и запрета кантования (ov)
- Многоплощадочная укладка и параллельное сравнение
- Реализация выравнивания (snap) и свешивания (hang) по физическим правилам
- Импорт/экспорт конфигураций, интеграция с реальным API JetLoader

## Лицензия

MIT
